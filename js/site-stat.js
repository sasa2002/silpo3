(new function(){const t=window.API_URL||"http://localhost:3000",e=["utm_source","utm_medium","utm_campaign","utm_term","utm_content"],s="__site-stat__";this.sessionId=null,this.isDebug=!1,this.state={referrer:"",utmTags:{}},this.getDataFromStorage=t=>{if(!localStorage.getItem(s))return null;try{const e=JSON.parse(localStorage.getItem(s));return t?e[t]:e}catch(t){return console.warn("Could'nt load initial data",t),null}},this.saveDataToStorage=(t,e)=>{try{const i=this.getDataFromStorage();localStorage.setItem(s,JSON.stringify({...i||{},[t]:e}))}catch(t){console.warn("Could'nt save data to storage",t)}},this.checkSessionTime=()=>{const t=this.getDataFromStorage("lasActivityTime");t&&Date.now()-t>=18e5&&this.createSession(!1),this.saveDataToStorage("lasActivityTime",Date.now()),this.log("lasActivityTime has been saved")},this.onMouseMove=()=>{this.checkSessionTime()},this.initEventListeners=()=>{const t=function(t,e=100){let s;return function(...i){clearTimeout(s),s=setTimeout((()=>{t.apply(this,i)}),e)}}(this.onMouseMove,200);document.addEventListener("mousemove",t),this.log("Event listeners have been initialized")},this.sendApiRequest=(t,e)=>{this.isDebug&&console.group("ApiRequest"),this.log("URL:",t),this.log("BODY:",e);const s=new XMLHttpRequest;s.open("POST",t),s.withCredentials=!0,s.crossDomain=!0,s.setRequestHeader("Content-Type","application/json;charset=UTF-8"),s.onload=()=>{this.log("XHR status",s.status),this.log("XHR response",s.response)},s.onerror=t=>{this.log("Network Error",t)},e.path=document.location.pathname,s.send(JSON.stringify(e)),this.isDebug&&console.groupEnd()},this.createSession=e=>{this.sessionId=function(){let t=(new Date).getTime(),e=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(s=>{var i=Math.floor;let o=16*Math.random();return 0<t?(o=0|(t+o)%16,t=i(t/16)):(o=0|(e+o)%16,e=i(e/16)),("x"===s?o:8|3&o).toString(16)}))}(),this.saveDataToStorage("sessionId",this.sessionId),this.sendApiRequest(`${t}/api/website/session/save`,{session:this.sessionId,referrer:this.state.referrer,increment_pageview:!!e,...this.state.utmTags}),this.log("New session has been created")},this.sendPageView=()=>{this.sendApiRequest(`${t}/api/website/session/save`,{session:this.sessionId,increment_pageview:!0}),this.log("Page view has been sent")},this.getUtmTags=()=>{const t=this.getDataFromStorage("utmTags");if(t)return t;const s=function(t){t||(t=window.location.search);const e=t.substr(1),s={};return!e.length||e.split("&").forEach((t=>{const e=t.split("=");s[e[0]]=decodeURIComponent(e[1])})),s}();return this.state.utmTags=Object.keys(s).filter((t=>-1<e.indexOf(t))).reduce(((t,e)=>({...t,[e]:s[e]})),{}),this.saveDataToStorage("utmTags",this.state.utmTags),this.log("utmTags parsed",this.state.utmTags),this.state.utmTags},this.initState=()=>{const t=this.getDataFromStorage();return this.state.utmTags=this.getUtmTags(),t?(this.state.referrer=t.referrer,void this.log("State has been filled from storage",this.state)):(this.state.referrer=document.referrer||"",this.saveDataToStorage("referrer",this.state.referrer),void this.log("State has been initialized",this.state))},this.initSession=()=>{const t=this.getDataFromStorage("sessionId");return t?(this.sessionId=t,void this.sendPageView()):void this.createSession(!0)},this.init=()=>{this.initState(),this.initSession(),this.initEventListeners(),setTimeout(this.checkSessionTime,0),this.log("SiteStatistics initialized"),this.log(this),window.wlStat=this},this.log=(...t)=>{this.isDebug&&console.info(...t)}}).init();